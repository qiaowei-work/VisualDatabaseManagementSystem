<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.mapper.UserMapper">
    
    <!-- 根据用户名查询用户 -->
    <select id="selectByUsername" resultType="User">
        SELECT
            id,
            username,
            password,
            email,
            real_name as realName,
            status,
            create_time as createTime,
            update_time as updateTime
        FROM
            sys_user
        WHERE
            username = #{username}
    </select>
    
    <!-- 根据邮箱查询用户 -->
    <select id="selectByEmail" resultType="User">
        SELECT
            id,
            username,
            password,
            email,
            real_name as realName,
            status,
            create_time as createTime,
            update_time as updateTime
        FROM
            sys_user
        WHERE
            email = #{email}
    </select>
    
    <!-- 插入新用户 -->
    <insert id="insert" parameterType="User" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_user (
            username,
            password,
            email,
            real_name,
            status,
            create_time,
            update_time
        ) VALUES (
            #{username},
            #{password},
            #{email},
            #{realName},
            #{status},
            #{createTime},
            #{updateTime}
        )
    </insert>
    
    <!-- 检查用户名是否存在 -->
    <select id="countByUsername" resultType="int">
        SELECT COUNT(1) FROM sys_user WHERE username = #{username}
    </select>
    
    <!-- 检查邮箱是否存在 -->
    <select id="countByEmail" resultType="int">
        SELECT COUNT(1) FROM sys_user WHERE email = #{email}
    </select>
    
    <!-- 查询所有用户列表 -->
    <select id="selectAllUsers" resultType="User">
        SELECT 
            id, 
            username, 
            password, 
            email, 
            real_name as realName, 
            status, 
            create_time as createTime, 
            update_time as updateTime 
        FROM sys_user 
        ORDER BY create_time DESC
    </select>
</mapper>